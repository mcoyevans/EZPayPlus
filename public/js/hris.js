var hris=angular.module("hris",[]);hris.controller("hrisContentContainerController",["$scope","$state","$mdMedia","Helper",function(e,t,o,i){(o("xs")||o("sm")||o("md"))&&e.$emit("closeSidenav"),e.toolbar={},e.subheader={},e.subheader.show=!0,e.subheader.toggleActive=function(){e.showInactive=!e.showInactive},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.fab={},e.fab.icon="mdi-plus",e.fab.label="Employee",e.fab.action=function(){t.go("main.manage-employee")},e.$on("search",function(){e.request.search=e.toolbar.searchText,e.refresh(),e.showInactive=!0}),e.$on("refresh",function(){e.request.search=null,e.refresh(),e.$broadcast("close")}),e.view=function(t){i.set(t);var o={template:"/app/components/hris/templates/dialogs/employee-information-dialog.template.html",controller:"employeeInformationDialogController",fullscreen:!0};i.customDialog(o).then(function(t){var o={};o.title="Delete",o.message="Are you sure you want to delete this employee?",o.ok="Delete",o.cancel="Cancel",t&&i.confirm(o).then(function(){i.preload(),i["delete"]("/employee/"+t).success(function(){i.stop(),e.refresh(),i.notify("Employee deleted.")}).error(function(){i.error()})})})},e.request={},e.request.paginate=20,e.request.withTrashed=!0,e.init=function(){e.model={},e.model.items=[],e.toolbar.items=[],e.model.page=2,i.post("/employee/enlist",e.request).success(function(t){e.model.details=t,e.model.items=t.data,e.model.show=!0,e.fab.show=!0,t.data.length&&angular.forEach(t.data,function(e){}),e.model.paginateLoad=function(){return e.model.busy||e.model.page>e.model.details.last_page?void(e.isLoading=!1):(e.model.busy=!0,e.isLoading=!0,void i.post("/employee/enlist?page="+e.model.page,e.request).success(function(t){e.model.page++,angular.forEach(t.data,function(t,o){e.model.items.push(t)}),e.model.busy=!1,e.isLoading=!1}))}})},e.refresh=function(){e.isLoading=!0,e.model.show=!1,e.init()},e.init()}]),hris.controller("manageEmployeeContentContainerController",["$scope","$filter","$state","$stateParams","$mdMedia","Helper",function(e,t,o,i,n,a){(n("xs")||n("sm")||n("md"))&&e.$emit("closeSidenav"),e.form={},e.employee={},e.employee.allowance_types=[],e.employee.deduction_types=[],e.toolbar={},e.calculateAge=function(t){var o=Date.now()-t.getTime(),i=new Date(o);e.employee.age=Math.abs(i.getUTCFullYear()-1970)},e.today=new Date,e.civil_status=["Single","Married","Widowed"],e.employment_status=["Probationary","Project Based","Regular"],e.checkDuplicate=function(){a.post("/employee/check-duplicate",e.employee).success(function(t){e.duplicate=t})},e.checkCity=function(){var t={};t.search=e.employee.city,t.strict_search=!0,a.post("/city/enlist",t).success(function(t){e.cities=t,e.showError=!t.length,e.employee.province_id&&e.checkProvince()})},e.fetchProvinces=function(){a.post("/province/enlist",e.employee).success(function(t){e.provinces=t})},e.checkProvince=function(){var t={};t.where=[{label:"id",condition:"=",value:e.employee.province_id}],t.city=e.employee.city,t.result="first",a.post("/province/enlist",t).success(function(t){e.noMatches=!t.cities.length})},e.formatPagIBIG=function(t){if(e.form.employeeForm.PagIBIG.$valid){var o=t.slice(0,4),i=t.slice(4,8),n=t.slice(8,12);e.employee.pagibig=o+"-"+i+"-"+n}},e.formatPhilHealth=function(t){if(e.form.employeeForm.PhilHealth.$valid){var o=t.slice(0,2),i=t.slice(2,11),n=t.slice(11,12);e.employee.philhealth=o+"-"+i+"-"+n}},e.formatSSS=function(t){if(e.form.employeeForm.SSS.$valid){var o=t.slice(0,2),i=t.slice(2,9),n=t.slice(9,10);e.employee.sss=o+"-"+i+"-"+n}},e.formatTIN=function(t){if(e.form.employeeForm.TIN.$valid){var o=t.slice(0,3),i=t.slice(3,6),n=t.slice(6,9);e.employee.tin=o+"-"+i+"-"+n}},e.addEarnings=function(){e.employee.allowance_types.push({})},e.addDeductions=function(){e.employee.deduction_types.push({})},e.removeEarnings=function(o){var i=e.employee.allowance_types.indexOf(o);if(o.de_minimis){var n=t("filter")(e.de_minimis,{id:o.de_minimis.id})[0],a=e.de_minimis.indexOf(n);if(e.de_minimis[a].balance=e.de_minimis[a].balance+(o.first_cut_off?o.amount:0)+(o.second_cut_off?o.amount:0)+(o.third_cut_off?o.amount:0)+(o.fourth_cut_off?o.amount:0),e.de_minimis[a].balance){var c=t("filter")(e.allowance_types,{id:o.allowance_type_id})[0],r=e.allowance_types.indexOf(c);e.allowance_types[r].maxed_out=!1}}e.employee.allowance_types.splice(i,1)},e.removeDeduction=function(t){var o=e.employee.deduction_types.indexOf(t);e.employee.deduction_types.splice(o,1)},e.checkDeduction=function(o,i){var n=t("filter")(e.employee.deduction_types,{deduction_type_id:o.deduction_type_id});i||angular.forEach(n,function(e){o.first_cut_off_checked=e.first_cut_off?e.first_cut_off:o.first_cut_off_checked,o.second_cut_off_checked=e.second_cut_off?e.second_cut_off:o.second_cut_off_checked,o.third_cut_off_checked=e.third_cut_off?e.third_cut_off:o.third_cut_off_checked,o.fourth_cut_off_checked=e.fourth_cut_off?e.fourth_cut_off:o.fourth_cut_off_checked})},e.checkDeMinimis=function(o,i){var n=t("filter")(e.allowance_types,{id:o.allowance_type_id})[0];o.de_minimis=n.de_minimis_id?n.de_minimis:null,o.max=n.de_minimis_id?t("filter")(e.de_minimis,{id:n.de_minimis_id})[0].balance:null;var a=t("filter")(e.employee.allowance_types,{allowance_type_id:o.allowance_type_id});i||angular.forEach(a,function(e){o.first_cut_off_checked=e.first_cut_off?e.first_cut_off:o.first_cut_off_checked,o.second_cut_off_checked=e.second_cut_off?e.second_cut_off:o.second_cut_off_checked,o.third_cut_off_checked=e.third_cut_off?e.third_cut_off:o.third_cut_off_checked,o.fourth_cut_off_checked=e.fourth_cut_off?e.fourth_cut_off:o.fourth_cut_off_checked})},e.checkLimit=function(o,i){var n=t("filter")(e.de_minimis,{id:o.de_minimis.id})[0],a=e.de_minimis.indexOf(n);if("undefined"!=typeof i&&(e.de_minimis[a].balance=i?e.de_minimis[a].balance-o.amount:e.de_minimis[a].balance+o.amount),o.limit=e.de_minimis[a].balance-o.amount<0,e.de_minimis[a].balance<=0){var c=t("filter")(e.allowance_types,{id:o.allowance_type_id})[0],r=e.allowance_types.indexOf(c);e.allowance_types[r].maxed_out=!0}},e.checkFrequency=function(t,o){t.checked=!!(t.first_cut_off||t.second_cut_off||t.third_cut_off||t.fourth_cut_off||t.on_hold),e.checkLimit(t,o)},e.fab={},e.fab.icon="mdi-check",e.fab.label="Submit",e.fab.show=!0,e.fab.action=function(){return e.form.employeeForm.$invalid?(angular.forEach(e.form.employeeForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}),void a.alert("Oops!","Kindly check form for errors.")):void(e.duplicate||(e.busy=!0,a.preload(),e.employee.birthdate=e.employee.birthdate.toLocaleDateString(),e.employee.date_hired=e.employee.date_hired.toDateString(),i.employeeID?(angular.forEach(e.employee.allowance_types,function(e,t){e.first_cut_off||delete e.first_cut_off,e.second_cut_off||delete e.second_cut_off,e.third_cut_off||delete e.third_cut_off,e.fourth_cut_off||delete e.fourth_cut_off,e.on_hold||delete e.on_hold}),angular.forEach(e.employee.deduction_types,function(e,t){e.first_cut_off||delete e.first_cut_off,e.second_cut_off||delete e.second_cut_off,e.third_cut_off||delete e.third_cut_off,e.fourth_cut_off||delete e.fourth_cut_off,e.on_hold||delete e.on_hold}),a.put("/employee/"+i.employeeID,e.employee).success(function(t){return a.stop(),t?(e.duplicate=t,void(e.busy=!1)):void o.go("main.hris")}).error(function(){e.employee.birthdate=new Date(e.employee.birthdate),e.employee.date_hired=new Date(e.employee.date_hired),e.busy=!1,e.error=!0,a.error()})):a.post("/employee",e.employee).success(function(t){return a.stop(),t?(e.duplicate=t,void(e.busy=!1)):void o.go("main.hris")}).error(function(){e.employee.birthdate=new Date(e.employee.birthdate),e.employee.date_hired=new Date(e.employee.date_hired),e.busy=!1,e.error=!0,a.error()})))},e.test=function(){e.employee.employee_number=10071128,e.employee.first_name="Marco Chrisitan",e.employee.middle_name="Santillan",e.employee.last_name="Paco",e.employee.birthdate=new Date("12/30/1993"),e.employee.age=22,e.employee.civil_status="Single",e.employee.batch_id=1,e.employee.branch_id=1,e.employee.cost_center_id=1,e.employee.position_id=1,e.employee.employment_status="Regular",e.employee.date_hired=new Date("07/29/2015"),e.employee.street_address="B3 L8 Terry Town Subdivision",e.employee.city="Santa Rosa City",e.employee.province_id=40,e.employee.postal_code=4026,e.employee.email="marcopaco1230@gmail.com",e.employee.mobile_number="09364589106",e.employee.telephone_number="(049) 543-1704",e.employee.tax_code_id=2,e.tin="012345678",e.sss="0123456789",e.pagibig="012345678901",e.philhealth="012345678901",e.employee.tin="012-345-678",e.employee.sss="01-2345678-9",e.employee.pagibig="0123-4567-8901",e.employee.philhealth="01-234567890-1",e.employee.time_interpretation_id=1,e.employee.basic_salary=14e3,e.employee.allowance_types=[{allowance_type_id:1,amount:100,first_cut_off:1,second_cut_off:1}],e.checkDeMinimis(e.employee.allowance_types[0],!0),e.checkFrequency(e.employee.allowance_types[0],1),e.checkFrequency(e.employee.allowance_types[0],1),e.employee.deduction_types=[{deduction_type_id:5,amount:100,first_cut_off:1,second_cut_off:1}]},e.init=function(){a.get("/batch").success(function(t){e.batches=t}),a.get("/branch").success(function(t){e.branches=t}),a.get("/cost-center").success(function(t){e.cost_centers=t}),a.get("/position").success(function(t){e.positions=t}),a.get("/tax-code").success(function(t){e.tax_codes=t}),a.get("/de-minimis").success(function(t){e.de_minimis=t,angular.forEach(e.de_minimis,function(e){e.balance=e.maximum_amount_per_month})});var t={"with":[{relation:"de_minimis",withTrashed:!1}]};a.post("/allowance-type/enlist",t).success(function(t){e.allowance_types=t});var o={where:[{label:"government_deduction",condition:"=",value:!1}]};a.post("/deduction-type/enlist",o).success(function(t){e.deduction_types=t}),a.get("/time-interpretation").success(function(t){e.time_interpretations=t}),e.checkCity(),e.fetchProvinces();var n={};if(n.orderBy=[{label:"employee_number",sort:"desc"}],n.first=!0,n.withTrashed=!0,a.post("/employee/enlist",n).success(function(t){e.last_employee_number=t.employee_number}),i.employeeID){var n={};n["with"]=[{relation:"allowance_types",withTrashed:!1},{relation:"deduction_types",withTrashed:!1},{relation:"batch",withTrashed:!0},{relation:"branch",withTrashed:!0},{relation:"cost_center",withTrashed:!0},{relation:"position",withTrashed:!0},{relation:"city",withTrashed:!1},{relation:"province",withTrashed:!1},{relation:"tax_code",withTrashed:!1},{relation:"time_interpretation",withTrashed:!1}],n.withTrashed=!0,n.first=!0,a.post("/employee/enlist",n).success(function(t){e.employee=t,e.employee.birthdate=new Date(t.birthdate),e.employee.date_hired=new Date(t.date_hired),e.employee.city=t.city.name,e.employee.province=t.province.name,e.tin=t.tin.replace(/-/g,""),e.sss=t.sss.replace(/-/g,""),e.pagibig=t.pagibig.replace(/-/g,""),e.philhealth=t.philhealth.replace(/-/g,""),angular.forEach(e.employee.allowance_types,function(t,o){e.employee.allowance_types[o]=t.pivot,e.checkDeMinimis(e.employee.allowance_types[o],!0),e.employee.allowance_types[o].first_cut_off&&e.checkFrequency(e.employee.allowance_types[o],1),e.employee.allowance_types[o].second_cut_off&&e.checkFrequency(e.employee.allowance_types[o],1),e.employee.allowance_types[o].third_cut_off&&e.checkFrequency(e.employee.allowance_types[o],1),e.employee.allowance_types[o].fourth_cut_off&&e.checkFrequency(e.employee.allowance_types[o],1)}),angular.forEach(e.employee.deduction_types,function(t,o){e.employee.deduction_types[o]=t.pivot}),e.toolbar.childState=t.last_name+", "+t.first_name}).error(function(){a.error()})}else e.toolbar.childState="Employee",e.employee.sex="Male",e.employee.date_hired=new Date,e.calculateAge(new Date)}()}]),hris.controller("employeeInformationDialogController",["$scope","$state","Helper",function(e,t,o){var i=(o.fetch(),{});i["with"]=[{relation:"allowance_types",withTrashed:!1},{relation:"deduction_types",withTrashed:!1},{relation:"batch",withTrashed:!0},{relation:"branch",withTrashed:!0},{relation:"cost_center",withTrashed:!0},{relation:"position",withTrashed:!0},{relation:"city",withTrashed:!1},{relation:"province",withTrashed:!1},{relation:"tax_code",withTrashed:!1},{relation:"time_interpretation",withTrashed:!1}],i.withTrashed=!0,i.first=!0,o.post("/employee/enlist",i).success(function(t){e.employee=t,e.employee.birthdate=new Date(t.birthdate),e.employee.date_hired=new Date(t.date_hired)}).error(function(){o.error()}),e.cancel=function(){o.cancel()},e.edit=function(){o.cancel(),t.go("main.manage-employee",{employeeID:e.employee.id})},e["delete"]=function(){o.stop(e.employee.id)}}]),hris.controller("hrisSubheaderController",["$scope","$state","Helper",function(e,t,o){e.subheader.menu=[{label:"Edit",icon:"mdi-pencil",show:!0,action:function(e){t.go("main.manage-employee-information",{employeeID:e.id})}},{label:"Delete",icon:"mdi-delete",show:!0,action:function(t){var i={};i.title="Delete",i.message="Delete "+t.first_name+"?",i.ok="Delete",i.cancel="Cancel",o.confirm(i).then(function(){o["delete"]("/employee/"+t.id).success(function(){o.notify("Employee deleted."),e.$emit("refresh")}).error(function(){o.error()})},function(){})}}],e.subheader.sort=[{label:"Employee Number",type:"employee_number",sortReverse:!1},{label:"First Name",type:"first_name",sortReverse:!1},{label:"Last Name",type:"last_name",sortReverse:!1},{label:"Age",type:"age",sortReverse:!1},{label:"Birthdate",type:"birthdate",sortReverse:!1}]}]),hris.controller("hrisToolbarController",["$scope","$filter",function(e,t){e.toolbar.childState="HRIS",e.$on("close",function(){e.hideSearchBar()}),e.toolbar.getItems=function(o){var i=o?t("filter")(e.toolbar.items,o):e.toolbar.items;return i},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.model.busy=!0,e.searchBar=!0,e.showInactive=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.model.page=1,e.model.no_matches=!1,e.model.items=[],e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0}}]),hris.controller("manageEmployeeToolbarController",["$scope","$filter",function(e,t){e.$on("close",function(){e.hideSearchBar()}),e.toolbar.getItems=function(o){var i=o?t("filter")(e.toolbar.items,o):e.toolbar.items;return i},e.toolbar.hideSearchIcon=!0,e.showSearchBar=function(){e.model.busy=!0,e.searchBar=!0,e.showInactive=!0},e.hideSearchBar=function(){e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.model.page=1,e.model.no_matches=!1,e.model.items=[],e.searched=!1,e.$emit("refresh"))},e.searchUserInput=function(){e.$emit("search"),e.searched=!0}}]);